<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmseed: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libmseed
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">The miniSEED data format library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#examples-overview">Overview</a></li>
<li class="level1"><a href="#example-msview">Read miniSEED from files</a></li>
<li class="level1"><a href="#example-lm_read_selection">Reading with selections</a></li>
<li class="level1"><a href="#example-lm_read_buffer">Reading from memory buffers</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="examples-overview"></a>
Overview</h1>
<p>The most basic usage of the library is illustrated in the <a class="el" href="page-tutorial.html">Tutorial</a>. This page contains full example programs that utilize the library for common tasks. These examples are included in the source distribution and (most) are used in the test suite.</p>
<p>While these are full working programs the aspects not related to library usage, e.g. argument parsing, are often minimized and left uncommented as they will change in real world usage.</p>
<h1><a class="anchor" id="example-msview"></a>
Read miniSEED from files</h1>
<p>A simple program to read miniSEED from files and print details from each record:</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * msview.c</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * A simple example of using libmseed.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Opens a user specified file, parses the Mini-SEED records and prints</span></div><div class="line"><span class="comment"> * details for each record.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Written by Chad Trabant</span></div><div class="line"><span class="comment"> *  IRIS Data Managment Center</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define VERSION &quot;[libmseed &quot; LIBMSEED_VERSION &quot; example]&quot;</span></div><div class="line"><span class="preprocessor">#define PACKAGE &quot;msview&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> int8_t verbose = 0;</div><div class="line"><span class="keyword">static</span> int8_t ppackets = 0;</div><div class="line"><span class="keyword">static</span> int8_t basicsum = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> printdata = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *inputfile = 0;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage (<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <a class="code" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = 0;</div><div class="line">  uint32_t flags = 0;</div><div class="line"></div><div class="line">  int64_t totalrecs = 0;</div><div class="line">  int64_t totalsamps = 0;</div><div class="line">  <span class="keywordtype">int</span> retcode;</div><div class="line"></div><div class="line">  <span class="comment">/* Process given parameters (command line and parameter file) */</span></div><div class="line">  <span class="keywordflow">if</span> (parameter_proc (argc, argv) &lt; 0)</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">  <span class="comment">/* Set flag to validate CRCs when reading */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Set flag to unpack data if printing samples */</span></div><div class="line">  <span class="keywordflow">if</span> (printdata)</div><div class="line">    flags |= <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Loop over the input file record by record */</span></div><div class="line">  <span class="keywordflow">while</span> ((retcode = <a class="code" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb">ms3_readmsr</a> (&amp;msr, inputfile, NULL, NULL,</div><div class="line">                                 flags, verbose)) == <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">  {</div><div class="line">    totalrecs++;</div><div class="line">    totalsamps += msr-&gt;<a class="code" href="group__miniseed-record.html#a85d0d5f365d50df0490d944dffdb3853">samplecnt</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a> (msr, ppackets);</div><div class="line"></div><div class="line">    <span class="comment">/* Print data samples */</span></div><div class="line">    <span class="keywordflow">if</span> (printdata &amp;&amp; msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> &gt; 0)</div><div class="line">    {</div><div class="line">      <span class="keywordtype">int</span> line, col, cnt, samplesize;</div><div class="line">      <span class="keywordtype">int</span> lines = (msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> / 6) + 1;</div><div class="line">      <span class="keywordtype">void</span> *sptr;</div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> ((samplesize = <a class="code" href="group__utility-functions.html#ga7595a7a94a4394418106d69b96e318f2">ms_samplesize</a> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>)) == 0)</div><div class="line">      {</div><div class="line">        <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unrecognized sample type: &#39;%c&#39;\n&quot;</span>, msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>);</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keywordflow">for</span> (cnt = 0, line = 0; line &lt; lines; line++)</div><div class="line">      {</div><div class="line">        <span class="keywordflow">for</span> (col = 0; col &lt; 6; col++)</div><div class="line">        {</div><div class="line">          <span class="keywordflow">if</span> (cnt &lt; msr-&gt;numsamples)</div><div class="line">          {</div><div class="line">            sptr = (<span class="keywordtype">char</span> *)msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> + (cnt * samplesize);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;i&#39;</span>)</div><div class="line">              <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;%10d  &quot;</span>, *(int32_t *)sptr);</div><div class="line"></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;f&#39;</span>)</div><div class="line">              <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;%10.8g  &quot;</span>, *(<span class="keywordtype">float</span> *)sptr);</div><div class="line"></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;d&#39;</span>)</div><div class="line">              <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;%10.10g  &quot;</span>, *(<span class="keywordtype">double</span> *)sptr);</div><div class="line"></div><div class="line">            cnt++;</div><div class="line">          }</div><div class="line">        }</div><div class="line">        <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">/* If only printing the first 6 samples break out here */</span></div><div class="line">        <span class="keywordflow">if</span> (printdata == 1)</div><div class="line">          <span class="keywordflow">break</span>;</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a>)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read %s: %s\n&quot;</span>, inputfile, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a> (retcode));</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <a class="code" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb">ms3_readmsr</a> (&amp;msr, NULL, NULL, NULL, 0, 0);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (basicsum)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Records: %&quot;</span> PRId64 <span class="stringliteral">&quot;, Samples: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">            totalrecs, totalsamps);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">/* End of main() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * parameter_proc():</span></div><div class="line"><span class="comment"> * Process the command line parameters.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Returns 0 on success, and -1 on failure</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec)</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> optind;</div><div class="line"></div><div class="line">  <span class="comment">/* Process all command line arguments */</span></div><div class="line">  <span class="keywordflow">for</span> (optind = 1; optind &lt; argcount; optind++)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-V&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">      exit (0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-h&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      usage ();</div><div class="line">      exit (0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      verbose += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;v&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-p&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      ppackets += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;p&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-d&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      printdata = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-D&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      printdata = 2;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-s&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      basicsum = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-&quot;</span>, 1) == 0 &amp;&amp;</div><div class="line">             strlen (argvec[optind]) &gt; 1)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div><div class="line">      exit (1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inputfile == 0)</div><div class="line">    {</div><div class="line">      inputfile = argvec[optind];</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div><div class="line">      exit (1);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure an inputfile was specified */</span></div><div class="line">  <span class="keywordflow">if</span> (!inputfile)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;No input file was specified\n\n&quot;</span>);</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version %s\n\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Try %s -h for usage\n&quot;</span>, PACKAGE);</div><div class="line">    exit (1);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Report the program version */</span></div><div class="line">  <span class="keywordflow">if</span> (verbose)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">/* End of parameter_proc() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * usage():</span></div><div class="line"><span class="comment"> * Print the usage message and exit.</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">usage (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s version: %s\n\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Usage: %s [options] file\n\n&quot;</span>, PACKAGE);</div><div class="line">  fprintf (stderr,</div><div class="line">           <span class="stringliteral">&quot; ## Options ##\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -V             Report program version\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -h             Show this usage message\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -v             Be more verbose, multiple flags can be used\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -p             Print details of header, multiple flags can be used\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -d             Print first 6 sample values\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -D             Print all sample values\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -s             Print a basic summary after processing a file\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; file           File of Mini-SEED records\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">} <span class="comment">/* End of usage() */</span></div></div><!-- fragment --><h1><a class="anchor" id="example-lm_read_selection"></a>
Reading with selections</h1>
<p>Read miniSEED with <a class="el" href="group__data-selections.html">Data Selections</a> used to limit what is read. Additionally, this program reads data into a <a class="el" href="group__trace-list.html">Trace List</a> and illustrates traversing the entries.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * lm_read_selection.c</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * A libmseed snippet program for reading miniSEED using data</span></div><div class="line"><span class="comment"> * selections to limit which data is read.  This program also</span></div><div class="line"><span class="comment"> * illustrates traversing a trace list.</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <a class="code" href="group__data-selections.html#struct_m_s3_selections">MS3Selections</a> *selections = NULL;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_i_d">MS3TraceID</a> *tid = NULL;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_seg">MS3TraceSeg</a> *seg = NULL;</div><div class="line"></div><div class="line">  <span class="keywordtype">char</span> *mseedfile = NULL;</div><div class="line">  <span class="keywordtype">char</span> *selectionfile = NULL;</div><div class="line">  <span class="keywordtype">char</span> starttimestr[30];</div><div class="line">  <span class="keywordtype">char</span> endtimestr[30];</div><div class="line">  uint32_t flags = 0;</div><div class="line">  int8_t verbose = 0;</div><div class="line">  <span class="keywordtype">int</span> rv;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (argc != 3)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Usage: %s &lt;mseedfile&gt; &lt;selectionfile&gt;\n&quot;</span>,argv[0]);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  mseedfile = argv[1];</div><div class="line">  selectionfile = argv[2];</div><div class="line"></div><div class="line">  <span class="comment">/* Read data selections from specified file */</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__data-selections.html#gaf8aa9de2cbbc18bc96fe3c4f0dfcb92d">ms3_readselectionsfile</a> (&amp;selections, selectionfile) &lt; 0)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read data selection file\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div><div class="line">  flags |= <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Read all miniSEED into a trace list, limiting to selections */</span></div><div class="line">  rv = <a class="code" href="group__io-functions.html#gae0cba40ee8021bcb8bcd3b35042f7b02">ms3_readtracelist_selection</a> (&amp;mstl, mseedfile, -1.0, -1.0,</div><div class="line">                                    selections, 0, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (rv != <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read miniSEED from file: %s\n&quot;</span>, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a>(rv));</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Traverse trace list structures and print summary information */</span></div><div class="line">  tid = mstl-&gt;<a class="code" href="group__trace-list.html#a4dddb7dd95226889820e4e8046c8bcb8">traces</a>;</div><div class="line">  <span class="keywordflow">while</span> (tid)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (tid-&gt;<a class="code" href="group__trace-list.html#a537e76409176bd8fca77a71e73b825fb">earliest</a>, starttimestr, SEEDORDINAL, NANO_MICRO_NONE) ||</div><div class="line">        !<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (tid-&gt;<a class="code" href="group__trace-list.html#a3464b9217cd83f1c8a1527ac2384ff63">latest</a>, endtimestr, SEEDORDINAL, NANO_MICRO_NONE))</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div><div class="line">      starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;TraceID for %s (%d), earliest: %s, latest: %s, segments: %d\n&quot;</span>,</div><div class="line">            tid-&gt;<a class="code" href="group__trace-list.html#aaa4e9d9d9fb4c2bf4f93472500744c52">sid</a>, tid-&gt;<a class="code" href="group__trace-list.html#a49a7a751c8f59f769ec3b6e29e8aacfd">pubversion</a>, starttimestr, endtimestr, tid-&gt;<a class="code" href="group__trace-list.html#afdbdeb4baba7b1b2bbdb92738344b70c">numsegments</a>);</div><div class="line"></div><div class="line">    seg = tid-&gt;<a class="code" href="group__trace-list.html#a2c57e9aa2e2b922b57df9ea8031aebde">first</a>;</div><div class="line">    <span class="keywordflow">while</span> (seg)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (!<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (seg-&gt;<a class="code" href="group__trace-list.html#afa4b2623a8ffb336a9d9d9a9773c0dc0">starttime</a>, starttimestr, SEEDORDINAL, NANO_MICRO_NONE) ||</div><div class="line">          !<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (seg-&gt;<a class="code" href="group__trace-list.html#a2c33217da025db4c975c4013629d53eb">endtime</a>, endtimestr, SEEDORDINAL, NANO_MICRO_NONE))</div><div class="line">      {</div><div class="line">        <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div><div class="line">        starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">      }</div><div class="line"></div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;  Segment %s - %s, samples: %d, sample rate: %g, sample type: %c\n&quot;</span>,</div><div class="line">              starttimestr, endtimestr, seg-&gt;<a class="code" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a>, seg-&gt;<a class="code" href="group__trace-list.html#acb10e4263b0aeaab66232c35d8c7d5ac">samprate</a>, seg-&gt;<a class="code" href="group__trace-list.html#a9addbbe3f6cbb7f742b8def029cde74e">sampletype</a>);</div><div class="line"></div><div class="line">      seg = seg-&gt;<a class="code" href="group__trace-list.html#ad5acfe831d046c60102414e333cb46a3">next</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    tid = tid-&gt;<a class="code" href="group__trace-list.html#a7010e1a21bb73ccf12c5bbd783bfc9da">next</a>;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <span class="keywordflow">if</span> (mstl)</div><div class="line">    <a class="code" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (selections)</div><div class="line">    <a class="code" href="group__data-selections.html#ga63f765d5d879a6e9c065e56c47a9d053">ms3_freeselections</a> (selections);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="example-lm_read_buffer"></a>
Reading from memory buffers</h1>
<p>Read miniSEED from memory buffers. In this case a file is read into a buffer simply to illustrate reading from a buffer. In practice this would functionality would be used with data received via a network connection or some other, non-file, mechanism.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * lm_read_buffer.c</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * A libmseed snippet program for reading miniSEED from buffers</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>stat sb = {0};</div><div class="line">  int64_t records = 0;</div><div class="line">  FILE *fh;</div><div class="line"></div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div><div class="line">  <span class="keywordtype">char</span> *buffer = NULL;</div><div class="line">  uint64_t bufferlength = 0;</div><div class="line">  <span class="keywordtype">double</span> timetol = -1;</div><div class="line">  <span class="keywordtype">double</span> sampratetol = -1;</div><div class="line">  int8_t splitversion = 0;</div><div class="line">  uint32_t flags = 0;</div><div class="line">  int8_t verbose = 0;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (argc != 2)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;%s requires a single file name argument\n&quot;</span>,argv[0]);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Read specified file into buffer */</span></div><div class="line">  <span class="keywordflow">if</span> (!(fh = fopen(argv[1], <span class="stringliteral">&quot;rb&quot;</span>)))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error opening %s: %s\n&quot;</span>, argv[1], strerror(errno));</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (fstat (fileno(fh), &amp;sb))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error stating %s: %s\n&quot;</span>, argv[1], strerror(errno));</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!(buffer = (<span class="keywordtype">char</span> *)malloc(sb.st_size)))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating buffer of %lld bytes\n&quot;</span>, (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sb.st_size);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (fread(buffer, sb.st_size, 1, fh) != 1)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error reading file\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  fclose(fh);</div><div class="line"></div><div class="line">  bufferlength = sb.st_size;</div><div class="line"></div><div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div><div class="line">  flags |= <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line"></div><div class="line">  mstl = <a class="code" href="group__trace-list.html#ga45e73d09fd22076373540407d45d1f6a">mstl3_init</a> (NULL);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (!mstl)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating MS3TraceList\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Read all miniSEED in buffer, accumulate in MS3TraceList */</span></div><div class="line">  records = <a class="code" href="group__trace-list.html#ga592d4a0909d6961f745098a556635b8f">mstl3_readbuffer</a> (&amp;mstl, buffer, bufferlength, timetol,</div><div class="line">                              sampratetol, splitversion, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (records &lt; 0)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Problem reading miniSEED from buffer: %s\n&quot;</span>, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a>(records));</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Print summary */</span></div><div class="line">  <a class="code" href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6">mstl3_printtracelist</a> (mstl, ISOMONTHDAY, 1, 1);</div><div class="line"></div><div class="line">  <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Total records: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, records);</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <span class="keywordflow">if</span> (mstl)</div><div class="line">    <a class="code" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div><div class="line"></div><div class="line">  free (buffer);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/iris-edu/libmseed" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>
